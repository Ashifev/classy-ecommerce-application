    <!-- Header Section Begin -->
    <%- include('../partials/userHeader') %>
    <!-- Header Section End -->
    <!-- <style>
        @import url('https://fonts.googleapis.com/css?family=Roboto:400,500,700');
       *
       {
           box-sizing: border-box;
           margin: 0;
           padding: 0;
       }
       
      
       
       a {
           text-decoration: none;
       }
       
       .product-card {
           margin-top: 13px;
           width: 300px;
           box-shadow: 0 2px 7px #dfdfdf;
           background: #fafafa;
       }
       
       .badge {
           position: absolute;
           left: 0;
           text-transform: uppercase;
           font-size: 13px;
           font-weight: 700;
           background: red;
           color: #fff;
           padding: 3px 10px;
       }
       
       .product-tumb {
           display: flex;
           align-items: center;
           justify-content: center;
           height: 300px;
           padding: 50px;
           background: #f0f0f0;
           overflow: hidden;
       }
       
       .product-tumb img {
           max-width: 100%;
           max-height: 100%;
           width: auto;
           height: auto;
           display: block;
           margin: 0 auto;
       }
       
       .product-details {
           padding: 30px;
       }
       
       .product-catagory {
           display: block;
           font-size: 12px;
           font-weight: 700;
           text-transform: uppercase;
           color: #ccc;
           margin-bottom: 18px;
       }
       
       .product-details h4 a {
           font-weight: 500;
           display: block;
           margin-bottom: 18px;
           text-transform: uppercase;
           color: #363636;
           text-decoration: none;
           transition: 0.3s;
       }
       
       .product-details h4 a:hover {
           color: #fbb72c;
       }
       
       .product-details p {
           font-size: 15px;
           line-height: 22px;
           margin-bottom: 18px;
           color: #999;
       }
       
       .product-bottom-details {
           overflow: hidden;
           border-top: 1px solid #eee;
           padding-top: 20px;
       }
       
       .product-bottom-details div {
           float: left;
           width: 50%;
       }
       
       .product-price {
           font-size: 18px;
           color: #fbb72c;
           font-weight: 600;
       }
       
       .product-price small {
           font-size: 80%;
           font-weight: 400;
           text-decoration: line-through;
           display: inline-block;
           margin-right: 5px;
       }
       
       .product-links {
           text-align: right;
       }
       
       .product-links a {
           display: inline-block;
           margin-left: 5px;
           color: #e1e1e1;
           transition: 0.3s;
           font-size: 17px;
       }
       
       .product-links a:hover {
           color: #fbb72c;
       }
       
       .single-product {
           box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
           transition: box-shadow 0.3s ease;
           margin-bottom: 15px;
       }
       
       .single-product:hover {
           box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
       }
       
       .product-img {
           height: 200px;
           display: flex;
           align-items: center;
           justify-content: center;
           overflow: hidden;
       }
       
       .product-img img {
           max-width: 100%;
           max-height: 100%;
           width: auto;
           height: auto;
           transition: transform 0.3s ease;
       }
       
       .product-img:hover img {
           transform: scale(1.05);
       }
       
       .p_icon {
           display: flex;
           justify-content: center;
           margin-top: 10px;
       }
       
       .p_icon a {
           display: flex;
           align-items: center;
           justify-content: center;
           width: 40px;
           height: 40px;
           margin-right: 5px;
           background-color: white;
           border-radius: 50%;
           box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
           transition: background-color 0.3s ease, transform 0.3s ease;
       }
       
       .p_icon a:hover {
           background-color: #f8f8f8;
           transform: scale(1.1);
       }
       
       .p_icon a i {
           color: #333;
           font-size: 16px;
       }
       
       .products-grid {
           display: grid;
           grid-template-columns: repeat(4, 1fr);
           gap: 20px;
       }
       
       .products-grid .single-product {
           background: #fff;
         
           border-radius: 10px;
           transition: transform 0.3s ease, box-shadow 0.3s ease;
       }
       
       .products-grid .single-product:hover {
           transform: translateY(-10px);
           box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
       }
       .offer-price {
         color: #ff4500; 
         font-size: 1.2em; 
         font-weight:100; 
         margin-left: 10px; 
       }

       .no-products {
  text-align: center;
  margin-top: 50px;
  font-size: 24px;
  font-weight: bold;
  color:gray;
  padding: 20px;
  border-radius: 5px;
  margin-left: 350px;
}

.no-products p {
  margin: 0;
  padding: 0;
}

       </style> -->

<!-- Breadcrumb Section Begin -->
<section class="breadcrumb-option">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="breadcrumb__text">
                    <h4>Shop</h4>
                    <div class="breadcrumb__links">
                        <a href="/">Home</a>
                        <span>Shop</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Breadcrumb Section End -->

<!-- Shop Section Begin -->
<section class="shop spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-3">
                <div class="shop__sidebar">
                    <div class="shop__sidebar__search">
                        <form id="searchForm" action="#">
                            <input type="text" id="searchInput" placeholder="Search...">
                            <button type="submit"><span class="icon_search"></span></button>
                        </form>
                    </div>
                    <div class="shop__sidebar__accordion">
                        <div class="accordion" id="accordionExample">
                          <div class="card">
                            <div class="card-heading">
                                <a data-toggle="collapse" data-target="#collapseOne">Categories</a>
                            </div>
                            <form id="filterForm">
                            <div id="collapseOne" class="collapse show" data-parent="#accordionExample">
                                <div class="card-body">
                                  <div id="panelsStayOpen-collapseCategory" class="accordion-collapse collapse show"
                                  aria-labelledby="headingCategory">
                                  <div class="accordion-body">
                                    <div>
                                      <% allCategory.forEach(category => { %>
                                        <div class="form-check">
                                          <input class="form-check-input" type="checkbox" id="CategoryCheckbox_<%= category.name %>" name="categories" value="<%= category.name %>" />
                                          <label class="form-check-label" for="CategoryCheckbox_<%= category.name %>"><%= category.name %></label>
                                        </div>
                                        <% }) %>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                            </div>
                          </div>
                          <div class="card">
                            <div class="card-heading">
                                <a data-toggle="collapse" data-target="#collapseTwo">Branding</a>
                            </div>
                            <div id="collapseTwo" class="collapse show" data-parent="#accordionExample">
                                <div class="card-body">
                                  <div id="panelsStayOpen-collapseBrands" class="accordion-collapse collapse show"
                                  aria-labelledby="headingBrands">
                                  <div class="accordion-body">
                                    <div>
                                      <% allBrand.forEach(brand => { %>
                                      <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="brandCheckbox_<%= brand.name %>" name="brands" value="<%= brand.name %>" />
                                        <label class="form-check-label" for="brandCheckbox_<%= brand.name %>"><%= brand.name %></label>
                                      </div>
                                      <% }) %>
                                    </div>
                                  </div>
                                </div>
                                </div>
                            </div>
                          </div>
                          <div class="card">
                            <div class="card-heading">
                                <a data-toggle="collapse" data-target="#collapseThree">Filter Price</a>
                            </div>
                            <div id="collapseThree" class="collapse show" data-parent="#accordionExample">
                                <div class="card-body">
                                  <div id="panelsStayOpen-collapseThree" class="accordion-collapse collapse show"
                                  aria-labelledby="headingThree">
                                  <div class="accordion-body">
                                    <div class="range">
                                      <input type="range" class="form-range" id="priceRange" 
                                        min="<%= Math.min(...product.map(p => p.price)) %>" 
                                        max="<%= Math.max(...product.map(p => p.price)) %>" 
                                        oninput="updateMaxPrice()" />
                                    </div>
                                    <div class="row mb-3">
                                      <div class="col-6">
                                        <p class="mb-0">Min</p>
                                        <div class="form-outline">
                                          <input type="number" id="minPrice" name="minPrice"
                                            class="form-control" value="<%= Math.min(...product.map(p => p.price)) %>" readonly />
                                          <label class="form-label" for="minPrice">₹ <%= Math.min(...product.map(p => p.price)) %></label>
                                        </div>
                                      </div>
                                      <div class="col-6">
                                        <p class="mb-0">Max</p>
                                        <div class="form-outline">
                                          <input type="number" id="maxPrice" name="maxPrice"
                                            class="form-control" value="<%= Math.max(...product.map(p => p.price)) %>" readonly />
                                          <label class="form-label" for="maxPrice">₹ <%= Math.max(...product.map(p => p.price)) %></label>
                                        </div>
                                      </div>
                                    </div>
                                    
                                  </div>
                                </div>
                                </div>
                            </div>
                            
                          </div>

                          <button type="submit" id="applyFilter" class="btn btn-white w-100 border border-secondary">Apply</button>
                        </form>           
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-9">
                <div class="shop__product__option">
                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-sm-6">
                            <div class="shop__product__option__left">
                                <p>Showing 1–12 of 126 results</p>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-6">
                            <div class="shop__product__option__right">
                                <p>Sort by Price:</p>
                                <select>
                                    <option value="">Low To High</option>
                                    <option value="">$0 - $55</option>
                                    <option value="">$55 - $100</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row product-grids">
                    <% product.forEach(function(product){ %>
                    <div class="col-lg-4 col-md-6 col-sm-6">
                        <div class="product__item">
                                <ul class="product__hover">
                                    <li><a href="/product-details/<%=product._id%>"><img src="<%=product.image[0]%>" alt=""></a></li>
                                    <li>
                                        <% if ( product.stockQuantity==0) { %>
                                            <span style="background-color:red;" class="badge badge-danger">Out of Stock</span>
                                        <% }else if (product.stockQuantity>5&&product.stockQuantity<10) { %>
                                            <span style="background-color:rgb(212, 156, 4);" class="badge badge-warning">Limited Stock</span>
                                        <% }else { %>
                                            <span style="background-color:rgb(3, 158, 3);" class="badge badge-success">InStock</span>
                                        <% } %>
                                        
                                    </li>
                                </ul>
                            <div class="product__item__text">
                                <h6><%=product.name%></h6>
                                <a style="cursor: pointer;" onclick="addToCart('<%=product._id%>','<%=product.price%>')" class="add-cart">+ Add To Cart</a>
                                <div class="rating">
                                    <i class="fa fa-star-o"></i>
                                    <i class="fa fa-star-o"></i>
                                    <i class="fa fa-star-o"></i>
                                    <i class="fa fa-star-o"></i>
                                    <i class="fa fa-star-o"></i>
                                </div>
                                <h5>₹<%=product.price%></h5>
                                
                            </div>
                        </div>
                    </div>
                    <%})%>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                      <div class="product__pagination">
                        <% if (currentPage > 1) { %>
                          <a href="?page=<%= currentPage - 1 %>">&laquo;</a>
                        <% } %>
                  
                        <% for (let i = 1; i <= totalPages; i++) { %>
                          <% if (i === currentPage) { %>
                            <a class="active" href="?page=<%= i %>"><%= i %></a>
                          <% } else { %>
                            <a href="?page=<%= i %>"><%= i %></a>
                          <% } %>
                        <% } %>
                  
                        <% if (currentPage < totalPages) { %>
                          <a href="?page=<%= currentPage + 1 %>">&raquo;</a>
                        <% } %>
                      </div>
                    </div>
                  </div>
                  
            </div>
        </div>
    </div>
</section>
<!-- Shop Section End -->

<script>
    function addToCart(productId,price) {
        var url = '/add-cart'

        $.ajax({
          url: url,
          type: 'POST',
          data:{
            productId : productId,
            price : price
          },
          success: function(response) {
            console.log(response)
            const Toast = Swal.mixin({
              toast: true,
              position: "top",
              showConfirmButton: false,
              timer: 800,
             
              didOpen: (toast) => {
                toast.onmouseenter = Swal.stopTimer;
                toast.onmouseleave = Swal.resumeTimer;
              }
            });
            Toast.fire({
              icon: response.icon,
              title: response.msg
            });
          },
          error: function(xhr, status, error) {
            Swal.fire({
              icon: 'error',
              title: 'Error',
              text: 'Failed to add item to cart. Please try again.',
            });
          }
        });
      }      
</script>


<!--Filtering , Search and Pagination-->
<script>
  let currentFilterParams = {};

function applyFilter(page = 1) {
  const selectedCategories = Array.from(document.querySelectorAll('input[name="categories"]:checked'))
    .map(checkbox => checkbox.value);
  const selectedBrands = Array.from(document.querySelectorAll('input[name="brands"]:checked'))
    .map(checkbox => checkbox.value);
  const maxPrice = document.getElementById('maxPrice').value;

  currentFilterParams = {
    selectedCategories: selectedCategories.join(','),
    selectedBrands: selectedBrands.join(','),
    maxPrice,
    page,
    limit: 6
  };

  const data = new URLSearchParams(currentFilterParams);

  fetch(`/filter-product?${data.toString()}`, {
    method: 'GET',
    headers: { 'Content-Type': 'application/json' }
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      displayProducts(data.products);
      displayPagination(data.currentPage, data.totalPages, applyFilter);
    } else {
      console.error("Error applying filter:", data.message);
    }
  })
  .catch(error => {
    console.error("Fetch error:", error);
  });
}

function searchProducts(page = 1) {
  const inputValue = document.getElementById('searchInput').value;
  const searchParams = new URLSearchParams({
    inputValue,
    page,
    limit: 6
  });

  fetch(`/searchProduct?${searchParams.toString()}`, {
    method: 'POST',
    headers: { 'Content-type': "application/json" },
  })
  .then((response) => response.json())
  .then(response => {
    if (response.success) {
      displayProducts(response.products);
      displayPagination(response.currentPage, response.totalPages, searchProducts);
    } else {
      console.error("Error applying filter:", response.message);
    }
  })
  .catch(error => {
    console.error("Fetch error:", error);
  });
}

function displayPagination(currentPage, totalPages, pageChangeFunction) {
  const paginationContainer = document.querySelector('.product__pagination');
  let paginationHTML = '';

  if (currentPage > 1) {
    paginationHTML += `<a href="#" onclick="event.preventDefault(); ${pageChangeFunction.name}(${currentPage - 1})">&laquo;</a>`;
  }

  for (let i = 1; i <= totalPages; i++) {
    if (i === currentPage) {
      paginationHTML += `<a class="active" href="#" onclick="event.preventDefault(); ${pageChangeFunction.name}(${i})">${i}</a>`;
    } else {
      paginationHTML += `<a href="#" onclick="event.preventDefault(); ${pageChangeFunction.name}(${i})">${i}</a>`;
    }
  }

  if (currentPage < totalPages) {
    paginationHTML += `<a href="#" onclick="event.preventDefault(); ${pageChangeFunction.name}(${currentPage + 1})">&raquo;</a>`;
  }

  paginationContainer.innerHTML = paginationHTML;
}

function displayProducts(products) {
  const productsGrid = document.querySelector('.product-grids');
  productsGrid.innerHTML = '';

  if (products.length === 0) {
    productsGrid.innerHTML = `
      <div class="no-products">
        <p>No products found</p>
      </div>
    `;
    return;
  }

  products.forEach(product => {
    const productHTML = `
      <div class="col-lg-4 col-md-6 col-sm-6">
        <div class="product__item">
          <ul class="product__hover">
            <li><a href="/product-details/${product._id}"><img src="${product.image[0]}" alt=""></a></li>
            <li>
              ${product.stockQuantity === 0 
                ? '<span style="background-color:red;" class="badge badge-danger">Out of Stock</span>'
                : product.stockQuantity > 5 && product.stockQuantity < 10
                  ? '<span style="background-color:rgb(212, 156, 4);" class="badge badge-warning">Limited Stock</span>'
                  : '<span style="background-color:rgb(3, 158, 3);" class="badge badge-success">InStock</span>'
              }
            </li>
          </ul>
          <div class="product__item__text">
            <h6>${product.name}</h6>
            <a style="cursor: pointer;" onclick="addToCart('${product._id}','${product.price}')" class="add-cart">+ Add To Cart</a>
            <div class="rating">
              <i class="fa fa-star-o"></i>
              <i class="fa fa-star-o"></i>
              <i class="fa fa-star-o"></i>
              <i class="fa fa-star-o"></i>
              <i class="fa fa-star-o"></i>
            </div>
            <h5>₹${product.price}</h5>
          </div>
        </div>
      </div>
    `;
    productsGrid.innerHTML += productHTML;
  });
}

document.getElementById('applyFilter').addEventListener('click', function(event) {
  event.preventDefault();
  applyFilter();
});

document.getElementById('searchForm').addEventListener('submit', function(event) {
  event.preventDefault();
  searchProducts();
});
</script>

<!-- Footer Section Begin -->
<%- include('../partials/userFooter') %>
<!-- Footer Section End -->